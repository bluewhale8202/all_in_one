{% extends "info/info_base.html" %}

{% block title %} 반품요청 조회 {% endblock %}

{% block script %}
<script>
    $(function() {
        // Currently, ESM allows only one row to be sellected
        // so we apply the same restriction to the checkboxes
        $('input:checkbox').on('click', function() {
            $('input:checkbox').not(this).prop('checked', false);
        });

        $('#confirm').on('submit', function(e){
            e.preventDefault();

            var oinfs = $("input:checked").parents("tr").find("input").serialize();
            var csrf = $("#confirm input[name='csrfmiddlewaretoken']").serialize();

            $.post({
                    url: "{% url 'info:toreturn_confirm' %}",
                    data: oinfs + "&" + csrf,
                    success: function(result,status,xhr) {
                        if (result['status'] === "ok"){
                            alert("반품등록 성공\n" + result['msg']); location.reload(); }
                        else { alert(result['msg']); location.reload(); }
                    },
            });
        });
    });
</script>
{% endblock %}

{% block submit_value %}
주문확인
{% endblock %}

{% block custom_fields_label %}
<th style="color:blue">주문번호</th>
<th style="color:blue">반품상태</th>
<th style="color:blue">반품신청일</th>
<th style="color:blue">__구매자</th>
{% endblock %}

{% block custom_fields_esm %}
<td>{{ entry.OrderNo }}</td>
<td>{{ entry.StatusName }}</td>
<td>{{ entry.ClaimRegDate }}</td>
{# Because esm is full of typos, this extra field is needed#}
<td>
{{ entry.BuyerId }},{{ entry.BuyerName }},
{{ entry.BuyerInfoCp }},{{ entry.BuyerInfoHt }}
</td>

{% endblock %}

{% block custom_fields_storefarm %}
<td>{{ entry.PRODUCT_ORDER_ID }}</td>    {# different from OrderNo #}
<td>{{ entry.CLAIM_STATUS }}</td>
<td>{{ entry.CLAIM_REQUEST_OPERATION_YMDT_RETURN }}</td>
<td>-</td>
{% endblock %}


{% comment %}


{% block content %}
    <style>
        table, td, th{
            border: 1px solid black;
            white-space:nowrap;
        }
        th{ text-align: center; }
        td{ padding: 5px; }
        ul li { display: inline; }
    </style>
    <div id="search">
        <form action="." method="post">
            {{ search_form.as_p }}

            {% csrf_token %}
            <input type="submit" value="Search">
        </form>
    </div>
    <form id="confirm" action="" method="post">
        <input type="submit" value="반품처리">
        {% csrf_token %}
        <table>
            <tr>
                <th style="min-width:30px">선택</th>
                <th style="color:blue">사이트</th>
                <th style="color:blue">몰 ID</th>

                <th style="color:blue">주문번호</th>
                <th style="color:blue">반품상태</th>
                <th style="color:blue">반품신청일</th>

                <th style="color:blue">구매자ID</th>
                <th style="color:blue">구매자</th>
                <th style="color:blue">전화번호1</th>
                <th style="color:blue">전화번호2</th>

                <th style="color:blue">상품명</th>
                <th style="color:blue">상품번호</th>
                <th style="color:blue">판매가</th>
                <th style="color:blue">입금일/결제일</th>
                <th style="color:blue">카트번호(E)</th>
                <th style="color:blue">배송비 묶음번호(N)</th>

                <th style="color:blue">배송타입</th>
                {# <th style="color:blue">배송주소</th>#}
                <th style="color:blue">수취인이름</th>
                <th style="color:blue">수취인전화번호1</th>
                <th style="color:blue">수취인전화번호2</th>
            </tr>
            {% for entry in entries %}
            {% if entry.site__ in "ESM/GMKT/AUC" %}
            <tr class="esm">
                <td><input style="margin: 0 8px 0" type="checkbox" name="orderInfo"
                    value="{{ entry.site__ }}/{{ entry.ESMID }}/{{ entry.OrderNo }},{{ entry.SiteIdValue }},{{ entry.SellerCustNo }},{{ entry.ReturnInvoiceNo }},{% if entry.ReturnDeliveryComp %}{{ entry.ReturnDeliveryComp }}{% else %}{% endif %}"></td>
                <td> {{ entry.site__ }}</td>
                <td>{{ entry.SellerId }}</td>

                <td>{{ entry.OrderNo }}</td>
                <td>{{ entry.StatusName }}</td>
                <td>{{ entry.ClaimRegDate }}</td>

                <td>{{ entry.BuyerId }}</td>
                <td>{{ entry.BuyerName }}</td>
                <td>{{ entry.BuyerInfoCp }}</td>
                <td>{{ entry.BuyerInfoHt }}</td>

                <td>{{ entry.GoodsName | safe}}</td>
                <td>{{ entry.GoodsNo }}</td>
                <td>{{ entry.SellPrice }}</td>
                <td>{{ entry.DepositConfirmDate }}</td>
                <td>{{ entry.CartNo }}</td>
                <td> - </td>

                <td>{{ entry.DeliveryFeeType }}</td>
                {# <td style="min-width:200px">{{ entry.RcverInfoAd | safe}}</td>#}
                <td> {{ entry.RcverName }}</td>
                <td>{{ entry.RcverInfoCp }}</td>
                <td>{{ entry.RcverInfoHt }}</td>
            </tr>
            {% elif entry.site__ == "STOREFARM" %}
            <tr class="storefarm">
                <td><input style="margin: 0 8px 0" type="checkbox" name="orderInfo"
                    value="-/-/-"></td>
                <td> {{ entry.site__ }}</td>
                <td> {{ entry.userid }} </td> {# id #}

                <td>{{ entry.PRODUCT_ORDER_ID }}</td>    {# different from OrderNo #}
                <td>{{ entry.CLAIM_STATUS }}</td>
                <td>{{ entry.CLAIM_REQUEST_OPERATION_YMDT_RETURN }}</td>

                <td>{{ entry.ORDER_ORDER_MEMBER_ID }}</td>
                <td>{{ entry.ORDER_ORDER_MEMBER_NAME }}</td>
                <td>{{ entry.ORDER_MEMBER_TELEPHONE_NO }}</td>
                <td> - </td>

                <td>{{ entry.PRODUCT_ORDER_DETAIL_PRODUCT_NAME | safe}}</td>
                <td>{{ entry.PRODUCT_ORDER_DETAIL_PRODUCT_NO }}</td>
                <td>{{ entry.PRODUCT_ORDER_DETAIL_PRODUCT_PRICE }}</td>
                <td>{{ entry.PAY_PAY_YMDT }}</td>
                <td> - </td>
                <td> {{ entry.ORDER_DELIVERY_FEE_BUNDLE_GROUP_SEQ }} </td>

                <td> - </td>
                {# <td>배송주소</td>#}
                <td> - </td>
                <td> - </td>
                <td> - </td>
            </tr>
            {% endif %}
            {% endfor %}
        </table>
    </form>

{% endblock %}
{% endcomment %}
